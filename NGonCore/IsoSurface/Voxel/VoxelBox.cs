using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace NGonCore.IsoSurface.Voxel
{
    public class VoxelBox
    {
        private static int[] VERTEXID = new int[]
        {
            1,
            2,
            4,
            8,
            16,
            32,
            64,
            128
        };

        private static int[] EDGEID = new int[]
        {
            1,
            2,
            4,
            8,
            16,
            32,
            64,
            128,
            256,
            512,
            1024,
            2048
        };

        private static int[,] EDGEVERTICES = new int[,]
        {
            {
                0,
                1
            },
            {
                1,
                2
            },
            {
                2,
                3
            },
            {
                3,
                0
            },
            {
                4,
                5
            },
            {
                5,
                6
            },
            {
                6,
                7
            },
            {
                7,
                4
            },
            {
                0,
                4
            },
            {
                1,
                5
            },
            {
                2,
                6
            },
            {
                3,
                7
            }
        };

        private static int[,] MAPV2E = new int[,]
        {
            {
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                8,
                3,
                9,
                8,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                1,
                2,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                2,
                10,
                0,
                2,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                8,
                3,
                2,
                10,
                8,
                10,
                9,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                11,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                11,
                2,
                8,
                11,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                9,
                0,
                2,
                3,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                11,
                2,
                1,
                9,
                11,
                9,
                8,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                10,
                1,
                11,
                10,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                10,
                1,
                0,
                8,
                10,
                8,
                11,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                9,
                0,
                3,
                11,
                9,
                11,
                10,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                8,
                10,
                10,
                8,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                7,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                3,
                0,
                7,
                3,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                8,
                4,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                1,
                9,
                4,
                7,
                1,
                7,
                3,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                8,
                4,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                4,
                7,
                3,
                0,
                4,
                1,
                2,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                2,
                10,
                9,
                0,
                2,
                8,
                4,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                10,
                9,
                2,
                9,
                7,
                2,
                7,
                3,
                7,
                9,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                4,
                7,
                3,
                11,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                4,
                7,
                11,
                2,
                4,
                2,
                0,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                0,
                1,
                8,
                4,
                7,
                2,
                3,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                7,
                11,
                9,
                4,
                11,
                9,
                11,
                2,
                9,
                2,
                1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                10,
                1,
                3,
                11,
                10,
                7,
                8,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                11,
                10,
                1,
                4,
                11,
                1,
                0,
                4,
                7,
                11,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                7,
                8,
                9,
                0,
                11,
                9,
                11,
                10,
                11,
                0,
                3,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                7,
                11,
                4,
                11,
                9,
                9,
                11,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                4,
                0,
                8,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                5,
                4,
                1,
                5,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                5,
                4,
                8,
                3,
                5,
                3,
                1,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                9,
                5,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                0,
                8,
                1,
                2,
                10,
                4,
                9,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                2,
                10,
                5,
                4,
                2,
                4,
                0,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                10,
                5,
                3,
                2,
                5,
                3,
                5,
                4,
                3,
                4,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                4,
                2,
                3,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                11,
                2,
                0,
                8,
                11,
                4,
                9,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                5,
                4,
                0,
                1,
                5,
                2,
                3,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                1,
                5,
                2,
                5,
                8,
                2,
                8,
                11,
                4,
                8,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                3,
                11,
                10,
                1,
                3,
                9,
                5,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                9,
                5,
                0,
                8,
                1,
                8,
                10,
                1,
                8,
                11,
                10,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                4,
                0,
                5,
                0,
                11,
                5,
                11,
                10,
                11,
                0,
                3,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                4,
                8,
                5,
                8,
                10,
                10,
                8,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                7,
                8,
                5,
                7,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                3,
                0,
                9,
                5,
                3,
                5,
                7,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                7,
                8,
                0,
                1,
                7,
                1,
                5,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                5,
                3,
                3,
                5,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                7,
                8,
                9,
                5,
                7,
                10,
                1,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                1,
                2,
                9,
                5,
                0,
                5,
                3,
                0,
                5,
                7,
                3,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                0,
                2,
                8,
                2,
                5,
                8,
                5,
                7,
                10,
                5,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                10,
                5,
                2,
                5,
                3,
                3,
                5,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                9,
                5,
                7,
                8,
                9,
                3,
                11,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                7,
                9,
                7,
                2,
                9,
                2,
                0,
                2,
                7,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                3,
                11,
                0,
                1,
                8,
                1,
                7,
                8,
                1,
                5,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                2,
                1,
                11,
                1,
                7,
                7,
                1,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                8,
                8,
                5,
                7,
                10,
                1,
                3,
                10,
                3,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                7,
                0,
                5,
                0,
                9,
                7,
                11,
                0,
                1,
                0,
                10,
                11,
                10,
                0,
                -1
            },
            {
                11,
                10,
                0,
                11,
                0,
                3,
                10,
                5,
                0,
                8,
                0,
                7,
                5,
                7,
                0,
                -1
            },
            {
                11,
                10,
                5,
                7,
                11,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                6,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                5,
                10,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                0,
                1,
                5,
                10,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                8,
                3,
                1,
                9,
                8,
                5,
                10,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                6,
                5,
                2,
                6,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                6,
                5,
                1,
                2,
                6,
                3,
                0,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                6,
                5,
                9,
                0,
                6,
                0,
                2,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                9,
                8,
                5,
                8,
                2,
                5,
                2,
                6,
                3,
                2,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                3,
                11,
                10,
                6,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                0,
                8,
                11,
                2,
                0,
                10,
                6,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                2,
                3,
                11,
                5,
                10,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                10,
                6,
                1,
                9,
                2,
                9,
                11,
                2,
                9,
                8,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                3,
                11,
                6,
                5,
                3,
                5,
                1,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                11,
                0,
                11,
                5,
                0,
                5,
                1,
                5,
                11,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                11,
                6,
                0,
                3,
                6,
                0,
                6,
                5,
                0,
                5,
                9,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                5,
                9,
                6,
                9,
                11,
                11,
                9,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                10,
                6,
                4,
                7,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                3,
                0,
                4,
                7,
                3,
                6,
                5,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                9,
                0,
                5,
                10,
                6,
                8,
                4,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                6,
                5,
                1,
                9,
                7,
                1,
                7,
                3,
                7,
                9,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                1,
                2,
                6,
                5,
                1,
                4,
                7,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                5,
                5,
                2,
                6,
                3,
                0,
                4,
                3,
                4,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                4,
                7,
                9,
                0,
                5,
                0,
                6,
                5,
                0,
                2,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                3,
                9,
                7,
                9,
                4,
                3,
                2,
                9,
                5,
                9,
                6,
                2,
                6,
                9,
                -1
            },
            {
                3,
                11,
                2,
                7,
                8,
                4,
                10,
                6,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                10,
                6,
                4,
                7,
                2,
                4,
                2,
                0,
                2,
                7,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                4,
                7,
                8,
                2,
                3,
                11,
                5,
                10,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                2,
                1,
                9,
                11,
                2,
                9,
                4,
                11,
                7,
                11,
                4,
                5,
                10,
                6,
                -1
            },
            {
                8,
                4,
                7,
                3,
                11,
                5,
                3,
                5,
                1,
                5,
                11,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                1,
                11,
                5,
                11,
                6,
                1,
                0,
                11,
                7,
                11,
                4,
                0,
                4,
                11,
                -1
            },
            {
                0,
                5,
                9,
                0,
                6,
                5,
                0,
                3,
                6,
                11,
                6,
                3,
                8,
                4,
                7,
                -1
            },
            {
                6,
                5,
                9,
                6,
                9,
                11,
                4,
                7,
                9,
                7,
                11,
                9,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                4,
                9,
                6,
                4,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                10,
                6,
                4,
                9,
                10,
                0,
                8,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                0,
                1,
                10,
                6,
                0,
                6,
                4,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                3,
                1,
                8,
                1,
                6,
                8,
                6,
                4,
                6,
                1,
                10,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                4,
                9,
                1,
                2,
                4,
                2,
                6,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                0,
                8,
                1,
                2,
                9,
                2,
                4,
                9,
                2,
                6,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                2,
                4,
                4,
                2,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                3,
                2,
                8,
                2,
                4,
                4,
                2,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                4,
                9,
                10,
                6,
                4,
                11,
                2,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                2,
                2,
                8,
                11,
                4,
                9,
                10,
                4,
                10,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                11,
                2,
                0,
                1,
                6,
                0,
                6,
                4,
                6,
                1,
                10,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                4,
                1,
                6,
                1,
                10,
                4,
                8,
                1,
                2,
                1,
                11,
                8,
                11,
                1,
                -1
            },
            {
                9,
                6,
                4,
                9,
                3,
                6,
                9,
                1,
                3,
                11,
                6,
                3,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                11,
                1,
                8,
                1,
                0,
                11,
                6,
                1,
                9,
                1,
                4,
                6,
                4,
                1,
                -1
            },
            {
                3,
                11,
                6,
                3,
                6,
                0,
                0,
                6,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                4,
                8,
                11,
                6,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                10,
                6,
                7,
                8,
                10,
                8,
                9,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                7,
                3,
                0,
                10,
                7,
                0,
                9,
                10,
                6,
                7,
                10,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                6,
                7,
                1,
                10,
                7,
                1,
                7,
                8,
                1,
                8,
                0,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                6,
                7,
                10,
                7,
                1,
                1,
                7,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                6,
                1,
                6,
                8,
                1,
                8,
                9,
                8,
                6,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                6,
                9,
                2,
                9,
                1,
                6,
                7,
                9,
                0,
                9,
                3,
                7,
                3,
                9,
                -1
            },
            {
                7,
                8,
                0,
                7,
                0,
                6,
                6,
                0,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                3,
                2,
                6,
                7,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                3,
                11,
                10,
                6,
                8,
                10,
                8,
                9,
                8,
                6,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                0,
                7,
                2,
                7,
                11,
                0,
                9,
                7,
                6,
                7,
                10,
                9,
                10,
                7,
                -1
            },
            {
                1,
                8,
                0,
                1,
                7,
                8,
                1,
                10,
                7,
                6,
                7,
                10,
                2,
                3,
                11,
                -1
            },
            {
                11,
                2,
                1,
                11,
                1,
                7,
                10,
                6,
                1,
                6,
                7,
                1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                9,
                6,
                8,
                6,
                7,
                9,
                1,
                6,
                11,
                6,
                3,
                1,
                3,
                6,
                -1
            },
            {
                0,
                9,
                1,
                11,
                6,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                8,
                0,
                7,
                0,
                6,
                3,
                11,
                0,
                11,
                6,
                0,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                11,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                6,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                0,
                8,
                11,
                7,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                11,
                7,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                1,
                9,
                8,
                3,
                1,
                11,
                7,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                1,
                2,
                6,
                11,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                3,
                0,
                8,
                6,
                11,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                9,
                0,
                2,
                10,
                9,
                6,
                11,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                11,
                7,
                2,
                10,
                3,
                10,
                8,
                3,
                10,
                9,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                2,
                3,
                6,
                2,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                0,
                8,
                7,
                6,
                0,
                6,
                2,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                7,
                6,
                2,
                3,
                7,
                0,
                1,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                6,
                2,
                1,
                8,
                6,
                1,
                9,
                8,
                8,
                7,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                7,
                6,
                10,
                1,
                7,
                1,
                3,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                7,
                6,
                1,
                7,
                10,
                1,
                8,
                7,
                1,
                0,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                3,
                7,
                0,
                7,
                10,
                0,
                10,
                9,
                6,
                10,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                6,
                10,
                7,
                10,
                8,
                8,
                10,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                8,
                4,
                11,
                8,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                6,
                11,
                3,
                0,
                6,
                0,
                4,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                6,
                11,
                8,
                4,
                6,
                9,
                0,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                4,
                6,
                9,
                6,
                3,
                9,
                3,
                1,
                11,
                3,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                8,
                4,
                6,
                11,
                8,
                2,
                10,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                3,
                0,
                11,
                0,
                6,
                11,
                0,
                4,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                11,
                8,
                4,
                6,
                11,
                0,
                2,
                9,
                2,
                10,
                9,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                9,
                3,
                10,
                3,
                2,
                9,
                4,
                3,
                11,
                3,
                6,
                4,
                6,
                3,
                -1
            },
            {
                8,
                2,
                3,
                8,
                4,
                2,
                4,
                6,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                4,
                2,
                4,
                6,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                9,
                0,
                2,
                3,
                4,
                2,
                4,
                6,
                4,
                3,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                9,
                4,
                1,
                4,
                2,
                2,
                4,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                1,
                3,
                8,
                6,
                1,
                8,
                4,
                6,
                6,
                10,
                1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                1,
                0,
                10,
                0,
                6,
                6,
                0,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                6,
                3,
                4,
                3,
                8,
                6,
                10,
                3,
                0,
                3,
                9,
                10,
                9,
                3,
                -1
            },
            {
                10,
                9,
                4,
                6,
                10,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                9,
                5,
                7,
                6,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                4,
                9,
                5,
                11,
                7,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                0,
                1,
                5,
                4,
                0,
                7,
                6,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                7,
                6,
                8,
                3,
                4,
                3,
                5,
                4,
                3,
                1,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                4,
                10,
                1,
                2,
                7,
                6,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                11,
                7,
                1,
                2,
                10,
                0,
                8,
                3,
                4,
                9,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                6,
                11,
                5,
                4,
                10,
                4,
                2,
                10,
                4,
                0,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                4,
                8,
                3,
                5,
                4,
                3,
                2,
                5,
                10,
                5,
                2,
                11,
                7,
                6,
                -1
            },
            {
                7,
                2,
                3,
                7,
                6,
                2,
                5,
                4,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                4,
                0,
                8,
                6,
                0,
                6,
                2,
                6,
                8,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                6,
                2,
                3,
                7,
                6,
                1,
                5,
                0,
                5,
                4,
                0,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                2,
                8,
                6,
                8,
                7,
                2,
                1,
                8,
                4,
                8,
                5,
                1,
                5,
                8,
                -1
            },
            {
                9,
                5,
                4,
                10,
                1,
                6,
                1,
                7,
                6,
                1,
                3,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                6,
                10,
                1,
                7,
                6,
                1,
                0,
                7,
                8,
                7,
                0,
                9,
                5,
                4,
                -1
            },
            {
                4,
                0,
                10,
                4,
                10,
                5,
                0,
                3,
                10,
                6,
                10,
                7,
                3,
                7,
                10,
                -1
            },
            {
                7,
                6,
                10,
                7,
                10,
                8,
                5,
                4,
                10,
                4,
                8,
                10,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                9,
                5,
                6,
                11,
                9,
                11,
                8,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                6,
                11,
                0,
                6,
                3,
                0,
                5,
                6,
                0,
                9,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                11,
                8,
                0,
                5,
                11,
                0,
                1,
                5,
                5,
                6,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                6,
                11,
                3,
                6,
                3,
                5,
                5,
                3,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                10,
                9,
                5,
                11,
                9,
                11,
                8,
                11,
                5,
                6,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                11,
                3,
                0,
                6,
                11,
                0,
                9,
                6,
                5,
                6,
                9,
                1,
                2,
                10,
                -1
            },
            {
                11,
                8,
                5,
                11,
                5,
                6,
                8,
                0,
                5,
                10,
                5,
                2,
                0,
                2,
                5,
                -1
            },
            {
                6,
                11,
                3,
                6,
                3,
                5,
                2,
                10,
                3,
                10,
                5,
                3,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                8,
                9,
                5,
                2,
                8,
                5,
                6,
                2,
                3,
                8,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                5,
                6,
                9,
                6,
                0,
                0,
                6,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                5,
                8,
                1,
                8,
                0,
                5,
                6,
                8,
                3,
                8,
                2,
                6,
                2,
                8,
                -1
            },
            {
                1,
                5,
                6,
                2,
                1,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                3,
                6,
                1,
                6,
                10,
                3,
                8,
                6,
                5,
                6,
                9,
                8,
                9,
                6,
                -1
            },
            {
                10,
                1,
                0,
                10,
                0,
                6,
                9,
                5,
                0,
                5,
                6,
                0,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                3,
                8,
                5,
                6,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                5,
                6,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                5,
                10,
                7,
                5,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                5,
                10,
                11,
                7,
                5,
                8,
                3,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                11,
                7,
                5,
                10,
                11,
                1,
                9,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                7,
                5,
                10,
                11,
                7,
                9,
                8,
                1,
                8,
                3,
                1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                1,
                2,
                11,
                7,
                1,
                7,
                5,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                1,
                2,
                7,
                1,
                7,
                5,
                7,
                2,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                7,
                5,
                9,
                2,
                7,
                9,
                0,
                2,
                2,
                11,
                7,
                -1,
                -1,
                -1,
                -1
            },
            {
                7,
                5,
                2,
                7,
                2,
                11,
                5,
                9,
                2,
                3,
                2,
                8,
                9,
                8,
                2,
                -1
            },
            {
                2,
                5,
                10,
                2,
                3,
                5,
                3,
                7,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                2,
                0,
                8,
                5,
                2,
                8,
                7,
                5,
                10,
                2,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                0,
                1,
                5,
                10,
                3,
                5,
                3,
                7,
                3,
                10,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                8,
                2,
                9,
                2,
                1,
                8,
                7,
                2,
                10,
                2,
                5,
                7,
                5,
                2,
                -1
            },
            {
                1,
                3,
                5,
                3,
                7,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                7,
                0,
                7,
                1,
                1,
                7,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                0,
                3,
                9,
                3,
                5,
                5,
                3,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                8,
                7,
                5,
                9,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                8,
                4,
                5,
                10,
                8,
                10,
                11,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                0,
                4,
                5,
                11,
                0,
                5,
                10,
                11,
                11,
                3,
                0,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                9,
                8,
                4,
                10,
                8,
                10,
                11,
                10,
                4,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                10,
                11,
                4,
                10,
                4,
                5,
                11,
                3,
                4,
                9,
                4,
                1,
                3,
                1,
                4,
                -1
            },
            {
                2,
                5,
                1,
                2,
                8,
                5,
                2,
                11,
                8,
                4,
                5,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                4,
                11,
                0,
                11,
                3,
                4,
                5,
                11,
                2,
                11,
                1,
                5,
                1,
                11,
                -1
            },
            {
                0,
                2,
                5,
                0,
                5,
                9,
                2,
                11,
                5,
                4,
                5,
                8,
                11,
                8,
                5,
                -1
            },
            {
                9,
                4,
                5,
                2,
                11,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                5,
                10,
                3,
                5,
                2,
                3,
                4,
                5,
                3,
                8,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                5,
                10,
                2,
                5,
                2,
                4,
                4,
                2,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                10,
                2,
                3,
                5,
                10,
                3,
                8,
                5,
                4,
                5,
                8,
                0,
                1,
                9,
                -1
            },
            {
                5,
                10,
                2,
                5,
                2,
                4,
                1,
                9,
                2,
                9,
                4,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                4,
                5,
                8,
                5,
                3,
                3,
                5,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                4,
                5,
                1,
                0,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                8,
                4,
                5,
                8,
                5,
                3,
                9,
                0,
                5,
                0,
                3,
                5,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                4,
                5,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                11,
                7,
                4,
                9,
                11,
                9,
                10,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                8,
                3,
                4,
                9,
                7,
                9,
                11,
                7,
                9,
                10,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                10,
                11,
                1,
                11,
                4,
                1,
                4,
                0,
                7,
                4,
                11,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                1,
                4,
                3,
                4,
                8,
                1,
                10,
                4,
                7,
                4,
                11,
                10,
                11,
                4,
                -1
            },
            {
                4,
                11,
                7,
                9,
                11,
                4,
                9,
                2,
                11,
                9,
                1,
                2,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                7,
                4,
                9,
                11,
                7,
                9,
                1,
                11,
                2,
                11,
                1,
                0,
                8,
                3,
                -1
            },
            {
                11,
                7,
                4,
                11,
                4,
                2,
                2,
                4,
                0,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                11,
                7,
                4,
                11,
                4,
                2,
                8,
                3,
                4,
                3,
                2,
                4,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                9,
                10,
                2,
                7,
                9,
                2,
                3,
                7,
                7,
                4,
                9,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                10,
                7,
                9,
                7,
                4,
                10,
                2,
                7,
                8,
                7,
                0,
                2,
                0,
                7,
                -1
            },
            {
                3,
                7,
                10,
                3,
                10,
                2,
                7,
                4,
                10,
                1,
                10,
                0,
                4,
                0,
                10,
                -1
            },
            {
                1,
                10,
                2,
                8,
                7,
                4,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                9,
                1,
                4,
                1,
                7,
                7,
                1,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                9,
                1,
                4,
                1,
                7,
                0,
                8,
                1,
                8,
                7,
                1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                0,
                3,
                7,
                4,
                3,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                4,
                8,
                7,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                10,
                8,
                10,
                11,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                0,
                9,
                3,
                9,
                11,
                11,
                9,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                1,
                10,
                0,
                10,
                8,
                8,
                10,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                1,
                10,
                11,
                3,
                10,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                2,
                11,
                1,
                11,
                9,
                9,
                11,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                0,
                9,
                3,
                9,
                11,
                1,
                2,
                9,
                2,
                11,
                9,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                2,
                11,
                8,
                0,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                3,
                2,
                11,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                3,
                8,
                2,
                8,
                10,
                10,
                8,
                9,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                9,
                10,
                2,
                0,
                9,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                2,
                3,
                8,
                2,
                8,
                10,
                0,
                1,
                8,
                1,
                10,
                8,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                10,
                2,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                1,
                3,
                8,
                9,
                1,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                9,
                1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                0,
                3,
                8,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            },
            {
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1,
                -1
            }
        };

        private int rx;

        private int ry;

        private int rz;

        private Vector VoxelSize;

        private double isovalue = 0.5;

        private double minval;

        private double maxval;

        private Vector minPoint;

        private Vector maxPoint;

        public VoxelVertex[] Vertices;

        private VoxelEdge[] Edges;

        private VoxelCube[] Cubes;

        private int basey;

        private int basez;

        private int EdgeCount;

        private int VertexCount;

        private int CubeCount;

        public LinkedList<VoxelFacet> Faces = new LinkedList<VoxelFacet>();

        public bool IsEmpty
        {
            get
            {
                return this.rx == 0;
            }
        }

        public double IsoValue
        {
            get
            {
                return this.isovalue;
            }
            set
            {
                this.isovalue = value;
                for (int i = 0; i < this.VertexCount; i++)
                {
                    this.Vertices[i].DValue = this.Vertices[i].Value - this.isovalue;
                }
            }
        }

        public double NormalizedIsoValue
        {
            get
            {
                double num = this.maxval - this.minval;
                if (num == 0.0)
                {
                    return 0.0;
                }
                return (this.isovalue - this.minval) / num;
            }
            set
            {
                this.IsoValue = this.minval + value * (this.maxval - this.minval);
            }
        }

        public double SetPlusMinusNormalizedIsoValue
        {
            get
            {
                double num = Math.Max(Math.Abs(this.minval), Math.Abs(this.maxval));
                if (num == 0.0)
                {
                    return 0.0;
                }
                return this.isovalue / num;
            }
            set
            {
                double num = Math.Max(Math.Abs(this.minval), Math.Abs(this.maxval));
                this.IsoValue = value * num;
            }
        }

        public int VoxRx
        {
            get
            {
                return this.rx;
            }
        }

        public int VoxRy
        {
            get
            {
                return this.ry;
            }
        }

        public int VoxRz
        {
            get
            {
                return this.rz;
            }
        }

        public int NodeRx
        {
            get
            {
                return this.rx + 1;
            }
        }

        public int NodeRy
        {
            get
            {
                return this.ry + 1;
            }
        }

        public int NodeRz
        {
            get
            {
                return this.rz + 1;
            }
        }

        public Vector MinPoint
        {
            get
            {
                return this.minPoint;
            }
        }

        public Vector MaxPoint
        {
            get
            {
                return this.maxPoint;
            }
        }

        public double MinValue
        {
            get
            {
                return this.minval;
            }
        }

        public double MaxValue
        {
            get
            {
                return this.maxval;
            }
        }

        public void Build(int _rx, int _ry, int _rz, Vector _minPoint, Vector _maxPoint)
        {
            int num;
            if (_rx != this.rx || _ry != this.ry || _rz != this.rz || this.Vertices == null || this.Edges == null || this.Cubes == null)
            {
                this.Clear();
                this.rx = _rx;
                this.ry = _ry;
                this.rz = _rz;
                this.basey = this.rx * (this.ry + 1) * (this.rz + 1);
                this.basez = this.basey + (this.rx + 1) * this.ry * (this.rz + 1);
                this.EdgeCount = this.rx * (this.ry + 1) * (this.rz + 1) + (this.rx + 1) * this.ry * (this.rz + 1) + (this.rx + 1) * (this.ry + 1) * this.rz;
                this.VertexCount = (this.rx + 1) * (this.ry + 1) * (this.rz + 1);
                this.CubeCount = this.rx * this.ry * this.rz;
                this.Vertices = new VoxelVertex[this.VertexCount];
                this.Edges = new VoxelEdge[this.EdgeCount];
                this.Cubes = new VoxelCube[this.CubeCount];
                for (int i = 0; i < this.VertexCount; i++)
                {
                    this.Vertices[i] = new VoxelVertex();
                }
                num = 0;
                for (int i = 0; i <= this.rz; i++)
                {
                    for (int j = 0; j <= this.ry; j++)
                    {
                        for (int k = 0; k < this.rx; k++)
                        {
                            this.Edges[num] = new VoxelEdge();
                            this.Edges[num].V[0] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            this.Edges[num].V[1] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k + 1];
                            num++;
                        }
                    }
                }
                for (int i = 0; i <= this.rz; i++)
                {
                    for (int j = 0; j < this.ry; j++)
                    {
                        for (int k = 0; k <= this.rx; k++)
                        {
                            this.Edges[num] = new VoxelEdge();
                            this.Edges[num].V[0] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            this.Edges[num].V[1] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + (j + 1) * (this.rx + 1) + k];
                            num++;
                        }
                    }
                }
                for (int i = 0; i < this.rz; i++)
                {
                    for (int j = 0; j <= this.ry; j++)
                    {
                        for (int k = 0; k <= this.rx; k++)
                        {
                            this.Edges[num] = new VoxelEdge();
                            this.Edges[num].V[0] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            this.Edges[num].V[1] = this.Vertices[(i + 1) * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            num++;
                        }
                    }
                }
                num = 0;
                for (int i = 0; i < this.rz; i++)
                {
                    for (int j = 0; j < this.ry; j++)
                    {
                        for (int k = 0; k < this.rx; k++)
                        {
                            this.Cubes[num] = new VoxelCube();
                            this.Cubes[num].V[0] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            this.Cubes[num].V[1] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k + 1];
                            this.Cubes[num].V[2] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + (j + 1) * (this.rx + 1) + k + 1];
                            this.Cubes[num].V[3] = this.Vertices[i * (this.rx + 1) * (this.ry + 1) + (j + 1) * (this.rx + 1) + k];
                            this.Cubes[num].V[4] = this.Vertices[(i + 1) * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k];
                            this.Cubes[num].V[5] = this.Vertices[(i + 1) * (this.rx + 1) * (this.ry + 1) + j * (this.rx + 1) + k + 1];
                            this.Cubes[num].V[6] = this.Vertices[(i + 1) * (this.rx + 1) * (this.ry + 1) + (j + 1) * (this.rx + 1) + k + 1];
                            this.Cubes[num].V[7] = this.Vertices[(i + 1) * (this.rx + 1) * (this.ry + 1) + (j + 1) * (this.rx + 1) + k];
                            this.Cubes[num].Edges[0] = this.Edges[i * (this.ry + 1) * this.rx + j * this.rx + k];
                            this.Cubes[num].Edges[1] = this.Edges[this.basey + i * this.ry * (this.rx + 1) + j * (this.rx + 1) + k + 1];
                            this.Cubes[num].Edges[2] = this.Edges[i * (this.ry + 1) * this.rx + (j + 1) * this.rx + k];
                            this.Cubes[num].Edges[3] = this.Edges[this.basey + i * this.ry * (this.rx + 1) + j * (this.rx + 1) + k];
                            this.Cubes[num].Edges[4] = this.Edges[(i + 1) * (this.ry + 1) * this.rx + j * this.rx + k];
                            this.Cubes[num].Edges[5] = this.Edges[this.basey + (i + 1) * this.ry * (this.rx + 1) + j * (this.rx + 1) + k + 1];
                            this.Cubes[num].Edges[6] = this.Edges[(i + 1) * (this.ry + 1) * this.rx + (j + 1) * this.rx + k];
                            this.Cubes[num].Edges[7] = this.Edges[this.basey + (i + 1) * this.ry * (this.rx + 1) + j * (this.rx + 1) + k];
                            this.Cubes[num].Edges[8] = this.Edges[this.basez + i * (this.ry + 1) * (this.rx + 1) + j * (this.rx + 1) + k];
                            this.Cubes[num].Edges[9] = this.Edges[this.basez + i * (this.ry + 1) * (this.rx + 1) + j * (this.rx + 1) + k + 1];
                            this.Cubes[num].Edges[10] = this.Edges[this.basez + i * (this.ry + 1) * (this.rx + 1) + (j + 1) * (this.rx + 1) + k + 1];
                            this.Cubes[num].Edges[11] = this.Edges[this.basez + i * (this.ry + 1) * (this.rx + 1) + (j + 1) * (this.rx + 1) + k];
                            num++;
                        }
                    }
                }
            }
            this.minPoint = _minPoint;
            this.maxPoint = _maxPoint;
            this.VoxelSize = this.maxPoint - this.minPoint;
            this.VoxelSize.x = this.VoxelSize.x / (double)this.rx;
            this.VoxelSize.y = this.VoxelSize.y / (double)this.ry;
            this.VoxelSize.z = this.VoxelSize.z / (double)this.rz;
            num = 0;
            for (int i = 0; i <= this.rz; i++)
            {
                for (int j = 0; j <= this.ry; j++)
                {
                    for (int k = 0; k <= this.rx; k++)
                    {
                        this.Vertices[num].P.Set(this.minPoint.x + (double)k * this.VoxelSize.x, this.minPoint.y + (double)j * this.VoxelSize.y, this.minPoint.z + (double)i * this.VoxelSize.z);
                        this.Vertices[num].Value = -1.0;
                        this.Vertices[num].DValue = -1.0;
                        num++;
                    }
                }
            }
        }

        public void MakeSurface()
        {
            if (this.Vertices == null)
            {
                return;
            }
            this.Faces.Clear();
            this.FindEdgeIntersections();
            this.BuildMesh();
        }

        private void FindEdgeIntersections()
        {
            if (this.Vertices == null)
            {
                return;
            }
            for (int i = 0; i < this.EdgeCount; i++)
            {
                if (this.Edges[i].V[0].DValue * this.Edges[i].V[1].DValue <= 0.0)
                {
                    this.Edges[i].HasIntersection = true;
                    this.Edges[i].Xpoint.P = this.Edges[i].V[0].P;
                    this.Edges[i].Xpoint.t = this.Edges[i].V[0].DValue / (this.Edges[i].V[0].DValue - this.Edges[i].V[1].DValue);
                    this.Edges[i].Xpoint.P.Add(this.Edges[i].Axis, this.Edges[i].Xpoint.t);
                }
                else
                {
                    this.Edges[i].HasIntersection = false;
                }
            }
        }

        private void BuildMesh()
        {
            if (this.Vertices == null)
            {
                return;
            }
            int num = 0;
            int num2 = (this.rx + 1) * (this.ry + 1);
            double num3 = 1.0 / this.VoxelSize.x;
            double num4 = 1.0 / this.VoxelSize.x;
            double num5 = 1.0 / this.VoxelSize.x;
            for (int i = 0; i <= this.rz; i++)
            {
                for (int j = 0; j <= this.ry; j++)
                {
                    for (int k = 0; k <= this.rx; k++)
                    {
                        if (k == 0)
                        {
                            this.Vertices[num].Gradient.x = (this.Vertices[num + 1].Value - this.Vertices[num].Value) * num3;
                        }
                        else if (k == this.rx)
                        {
                            this.Vertices[num].Gradient.x = (this.Vertices[num].Value - this.Vertices[num - 1].Value) * num3;
                        }
                        else
                        {
                            this.Vertices[num].Gradient.x = (this.Vertices[num + 1].Value - this.Vertices[num - 1].Value) * num3 * 0.5;
                        }
                        if (j == 0)
                        {
                            this.Vertices[num].Gradient.y = (this.Vertices[num + this.rx + 1].Value - this.Vertices[num].Value) * num4;
                        }
                        else if (j == this.ry)
                        {
                            this.Vertices[num].Gradient.y = (this.Vertices[num].Value - this.Vertices[num - this.rx - 1].Value) * num4;
                        }
                        else
                        {
                            this.Vertices[num].Gradient.y = (this.Vertices[num + this.rx + 1].Value - this.Vertices[num - this.rx - 1].Value) * num4 * 0.5;
                        }
                        if (i == 0)
                        {
                            this.Vertices[num].Gradient.z = (this.Vertices[num + num2].Value - this.Vertices[num].Value) * num5;
                        }
                        else if (i == this.rz)
                        {
                            this.Vertices[num].Gradient.z = (this.Vertices[num].Value - this.Vertices[num - num2].Value) * num5;
                        }
                        else
                        {
                            this.Vertices[num].Gradient.z = (this.Vertices[num + num2].Value - this.Vertices[num - num2].Value) * num5 * 0.5;
                        }
                        num++;
                    }
                }
            }
            for (int k = 0; k < this.EdgeCount; k++)
            {
                if (this.Edges[k].HasIntersection)
                {
                    this.Edges[k].Xpoint.Gradient.Sum(this.Edges[k].V[0].Gradient, 1.0 - this.Edges[k].Xpoint.t, this.Edges[k].V[1].Gradient, this.Edges[k].Xpoint.t);
                }
            }
            for (int k = 0; k < this.CubeCount; k++)
            {
                int num6 = 0;
                if (this.Cubes[k].V[0].DValue > 0.0)
                {
                    num6 |= 1;
                }
                if (this.Cubes[k].V[1].DValue > 0.0)
                {
                    num6 |= 2;
                }
                if (this.Cubes[k].V[2].DValue > 0.0)
                {
                    num6 |= 4;
                }
                if (this.Cubes[k].V[3].DValue > 0.0)
                {
                    num6 |= 8;
                }
                if (this.Cubes[k].V[4].DValue > 0.0)
                {
                    num6 |= 16;
                }
                if (this.Cubes[k].V[5].DValue > 0.0)
                {
                    num6 |= 32;
                }
                if (this.Cubes[k].V[6].DValue > 0.0)
                {
                    num6 |= 64;
                }
                if (this.Cubes[k].V[7].DValue > 0.0)
                {
                    num6 |= 128;
                }
                int j = 0;
                while (j <= 12 && VoxelBox.MAPV2E[num6, j] != -1)
                {
                    this.MakeFace(this.Cubes[k], num6, j);
                    j += 3;
                }
            }
        }

        public void Clear()
        {
            this.Vertices = null;
            this.Edges = null;
            this.Cubes = null;
            this.rx = 0;
            this.ry = 0;
            this.rz = 0;
            this.Faces.Clear();
        }

        public void UpdateMinMax()
        {
            this.minval = 1.7976931348623157E+308;
            this.maxval = -1.7976931348623157E+308;
            for (int i = 0; i < this.VertexCount; i++)
            {
                if (this.minval > this.Vertices[i].Value)
                {
                    this.minval = this.Vertices[i].Value;
                }
                if (this.maxval < this.Vertices[i].Value)
                {
                    this.maxval = this.Vertices[i].Value;
                }
            }
        }

        private void MakeFace(VoxelEdge _e0, VoxelEdge _e1, VoxelEdge _e2)
        {
            VoxelFacet voxFacet = new VoxelFacet();
            voxFacet.Edges[0] = _e0;
            voxFacet.Edges[1] = _e1;
            voxFacet.Edges[2] = _e2;
            voxFacet.Normal.Normal3P(_e0.Xpoint.P, _e1.Xpoint.P, _e2.Xpoint.P);
            this.Faces.AddLast(voxFacet);
        }

        private void MakeFace(VoxelCube _Cube, int CubeState, int EdgeId)
        {
            if (VoxelBox.MAPV2E[CubeState, EdgeId] == -1)
            {
                return;
            }
            this.MakeFace(_Cube.Edges[VoxelBox.MAPV2E[CubeState, EdgeId]], _Cube.Edges[VoxelBox.MAPV2E[CubeState, EdgeId + 1]], _Cube.Edges[VoxelBox.MAPV2E[CubeState, EdgeId + 2]]);
        }

        public static int GetIntersectionSignature(double[] d, double iso)
        {
            int num = 0;
            for (int i = 0; i < 8; i++)
            {
                if (d[i] - iso > 0.0)
                {
                    num |= VoxelBox.VERTEXID[i];
                }
            }
            return num;
        }

        public static bool IsSignatureIntersection(int sig)
        {
            return VoxelBox.MAPV2E[sig, 0] != -1;
        }

        public static int GetFaces(Vector[] corners, Vector[] fpoints, double[] d, double iso, int signature)
        {
            if (!VoxelBox.IsSignatureIntersection(signature))
            {
                return 0;
            }
            int num = 0;
            while (num < 16 && VoxelBox.MAPV2E[signature, num] != -1)
            {
                int num2 = VoxelBox.EDGEVERTICES[VoxelBox.MAPV2E[signature, num], 0];
                int num3 = VoxelBox.EDGEVERTICES[VoxelBox.MAPV2E[signature, num], 1];
                fpoints[num] = corners[num2];
                double scale = (d[num2] - iso) / (d[num2] - d[num3]);
                fpoints[num].Add(corners[num3] - corners[num2], scale);
                num++;
            }
            return num;
        }

        public static int GetFaces(Vector[] corners, Vector[] fpoints, double[] d, double iso)
        {
            int intersectionSignature = VoxelBox.GetIntersectionSignature(d, iso);
            if (!VoxelBox.IsSignatureIntersection(intersectionSignature))
            {
                return 0;
            }
            return VoxelBox.GetFaces(corners, fpoints, d, iso, intersectionSignature);
        }

        public static int GetFacesPlusInterpolatedValues(double[] cornervalues, double[] intervalues, Vector[] corners, Vector[] fpoints, double[] d, double iso, int signature)
        {
            if (!VoxelBox.IsSignatureIntersection(signature))
            {
                return 0;
            }
            int num = 0;
            while (num < 16 && VoxelBox.MAPV2E[signature, num] != -1)
            {
                int num2 = VoxelBox.EDGEVERTICES[VoxelBox.MAPV2E[signature, num], 0];
                int num3 = VoxelBox.EDGEVERTICES[VoxelBox.MAPV2E[signature, num], 1];
                fpoints[num] = corners[num2];
                double num4 = (d[num2] - iso) / (d[num2] - d[num3]);
                fpoints[num].Add(corners[num3] - corners[num2], num4);
                intervalues[num] = cornervalues[num2] + (cornervalues[num3] - cornervalues[num2]) * num4;
                num++;
            }
            return num;
        }

        public static int GetFacesPlusInterpolatedValues(double[] cornervalues, double[] intervalues, Vector[] corners, Vector[] fpoints, double[] d, double iso)
        {
            int intersectionSignature = VoxelBox.GetIntersectionSignature(d, iso);
            if (!VoxelBox.IsSignatureIntersection(intersectionSignature))
            {
                return 0;
            }
            return VoxelBox.GetFacesPlusInterpolatedValues(cornervalues, intervalues, corners, fpoints, d, iso, intersectionSignature);
        }
    }
}
